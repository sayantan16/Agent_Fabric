<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Agentic Fabric - Multi-Agent AI Orchestration Platform"
    />
    <title>{% block title %}{{ app_name }}{% endblock %}</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- HTMX Library -->
    <script src="https://unpkg.com/htmx.org@1.9.8"></script>

    <!-- Alpine.js for reactivity -->
    <script
      defer
      src="https://unpkg.com/alpinejs@3.13.2/dist/cdn.min.js"
    ></script>

    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/custom.css') }}"
    />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/x-icon"
      href="{{ url_for('static', filename='favicon.ico') }}"
    />

    <style>
      /* Badges used across pages */
      .badge {
        display: inline-flex;
        align-items: center;
        padding: 0.125rem 0.625rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
      }
      .badge-primary {
        background-color: #dbeafe; /* tailwind blue-100 */
        color: #1e40af; /* tailwind blue-800 */
      }
      .badge-success {
        background-color: #dcfce7; /* tailwind green-100 */
        color: #166534; /* tailwind green-800 */
      }
      .badge-warning {
        background-color: #fef3c7; /* tailwind yellow-100 */
        color: #92400e; /* tailwind yellow-800 */
      }
      .badge-error {
        background-color: #fee2e2; /* tailwind red-100 */
        color: #991b1b; /* tailwind red-800 */
      }
      .badge-secondary {
        background-color: #f3f4f6; /* tailwind gray-100 */
        color: #1f2937; /* tailwind gray-800 */
      }
      .badge-xs {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
        padding-top: 0.125rem;
        padding-bottom: 0.125rem;
        font-size: 0.75rem;
      }
      .badge-sm {
        padding-left: 0.625rem;
        padding-right: 0.625rem;
        padding-top: 0.25rem;
        padding-bottom: 0.25rem;
        font-size: 0.875rem;
      }

      /* Progress bar used on processing workflows */
      .progress-bar {
        width: 100%;
        background-color: #e5e7eb; /* tailwind gray-200 */
        border-radius: 9999px;
        height: 0.5rem;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(
          to right,
          #3b82f6,
          #2563eb
        ); /* from blue-500 to blue-600 */
        border-radius: 9999px;
        transition: all 500ms ease-out;
      }
    </style>

    <style>
      /* --- Cards --- */
      .card {
        background: #fff;
        border: 1px solid #e5e7eb; /* gray-200 */
        border-radius: 0.5rem; /* rounded-lg */
        overflow: hidden;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); /* shadow-sm */
        transition: box-shadow 200ms;
      }
      .card:hover {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      .card-header,
      .card-footer {
        padding: 1rem 1.5rem;
        background: #f9fafb;
        border-top: 1px solid #e5e7eb;
      }
      .card-header {
        border-top: none;
        border-bottom: 1px solid #e5e7eb;
      }
      .card-body {
        padding: 1rem 1.5rem;
      }

      /* --- Buttons --- */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.5rem 1rem;
        border-radius: 0.375rem; /* rounded-md */
        font-size: 0.875rem;
        line-height: 1.25rem;
        font-weight: 500;
        border: 1px solid #d1d5db; /* gray-300 */
        transition: background-color 200ms, color 200ms, border-color 200ms,
          box-shadow 200ms;
      }
      .btn-sm {
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
      }
      .btn-lg {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
      }

      .btn-primary {
        background: #2563eb;
        color: #fff;
        border-color: transparent;
      }
      .btn-primary:hover {
        background: #1d4ed8;
      }
      .btn-secondary {
        background: #fff;
        color: #374151;
        border-color: #d1d5db;
      }
      .btn-secondary:hover {
        background: #f9fafb;
      }
      .btn-success {
        background: #16a34a;
        color: #fff;
        border-color: transparent;
      }
      .btn-success:hover {
        background: #15803d;
      }
      .btn-danger {
        background: #dc2626;
        color: #fff;
        border-color: transparent;
      }
      .btn-danger:hover {
        background: #b91c1c;
      }

      /* --- Nav links --- */
      .nav-link {
        color: #4b5563; /* gray-600 */
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-weight: 500;
        transition: color 200ms, background-color 200ms;
      }
      .nav-link:hover {
        color: #111827;
      } /* gray-900 */
      .nav-link.active {
        color: #2563eb;
        background: #eff6ff;
      } /* blue-600 on blue-50 */

      .mobile-nav-link {
        display: block;
        padding: 0.5rem 0.75rem;
        font-size: 1rem;
        font-weight: 500;
        color: #4b5563;
        transition: color 200ms, background-color 200ms;
      }
      .mobile-nav-link:hover {
        color: #111827;
        background: #f9fafb;
      }

      /* --- Alerts --- */
      .alert {
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        max-width: 28rem;
      }
      .alert-success {
        background: #10b981;
        color: #fff;
      }
      .alert-error {
        background: #ef4444;
        color: #fff;
      }
      .alert-warning {
        background: #f59e0b;
        color: #fff;
      }
      .alert-info {
        background: #3b82f6;
        color: #fff;
      }

      /* --- Status dots --- */
      .status-dot {
        display: inline-block;
        width: 0.75rem;
        height: 0.75rem;
        border-radius: 9999px;
      }
      .status-active {
        background: #22c55e;
      }
      .status-pending {
        background: #f59e0b;
      }
      .status-error {
        background: #ef4444;
      }
      .status-inactive {
        background: #9ca3af;
      }
    </style>

    <!-- Configure Tailwind -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'agent-blue': '#3b82f6',
              'tool-green': '#10b981',
              'workflow-purple': '#8b5cf6',
              'success-green': '#059669',
              'error-red': '#dc2626',
              'warning-yellow': '#d97706',
            },
            animation: {
              'pulse-slow': 'pulse 3s ease-in-out infinite',
              'bounce-subtle': 'bounce 2s ease-in-out infinite',
              'fade-in': 'fadeIn 0.5s ease-in-out',
              'slide-up': 'slideUp 0.3s ease-out',
            },
          },
        },
      };
    </script>

    <!-- Mermaid (global) -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        if (window.mermaid) {
          mermaid.initialize({
            startOnLoad: false, // we render manually
            securityLevel: 'loose',
            theme: 'default',
            flowchart: { useMaxWidth: true, htmlLabels: true },
          });
        }
      });
    </script>

    {% block head %}{% endblock %}
  </head>
  <body
    class="bg-gray-50 min-h-screen"
    x-data="appData()"
    :class="{ 'dark': darkMode }"
  >
    <!-- Navigation Header -->
    <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <!-- Logo and Brand -->
          <div class="flex items-center">
            <a
              href="{{ url_for('main.index') }}"
              class="flex items-center space-x-3"
            >
              <div
                class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center"
              >
                <span class="text-white font-bold text-sm">AF</span>
              </div>
              <span class="text-xl font-semibold text-gray-900"
                >{{ app_name }}</span
              >
            </a>
          </div>

          <!-- Navigation Links -->
          <div class="hidden md:flex items-center space-x-8">
            <a
              href="{{ url_for('main.index') }}"
              class="nav-link {% if request.endpoint == 'main.index' %}active{% endif %}"
            >
              Chat
            </a>
            <a
              href="{{ url_for('main.registry') }}"
              class="nav-link {% if request.endpoint == 'main.registry' %}active{% endif %}"
            >
              Registry
            </a>
            <a
              href="{{ url_for('main.workflows') }}"
              class="nav-link {% if request.endpoint == 'main.workflows' %}active{% endif %}"
            >
              Workflows
            </a>
            <a
              href="{{ url_for('main.dependencies') }}"
              class="nav-link {% if request.endpoint == 'main.dependencies' %}active{% endif %}"
            >
              Dependencies
            </a>
          </div>

          <!-- Status and Controls -->
          <div class="flex items-center space-x-4">
            <!-- System Status Indicator -->
            <div class="flex items-center space-x-2">
              <div
                id="status-indicator"
                class="w-3 h-3 rounded-full transition-colors duration-300"
                :class="systemStatus.connected ? 'bg-green-500' : 'bg-red-500'"
                hx-get="{{ url_for('api.health_check') }}"
                hx-trigger="every 30s"
                hx-swap="none"
                hx-on:htmx:after-request="updateSystemStatus(event)"
              ></div>
              <span
                class="text-sm text-gray-600"
                x-text="systemStatus.message"
              ></span>
            </div>

            <!-- Theme Toggle -->
            <button
              @click="toggleDarkMode()"
              class="p-2 text-gray-600 hover:text-gray-900 transition-colors"
            >
              <svg
                x-show="!darkMode"
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                ></path>
              </svg>
              <svg
                x-show="darkMode"
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                ></path>
              </svg>
            </button>

            <!-- Settings -->
            <a
              href="{{ url_for('main.settings') }}"
              class="p-2 text-gray-600 hover:text-gray-900 transition-colors"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                ></path>
              </svg>
            </a>

            <!-- Mobile menu button -->
            <div class="md:hidden">
              <button
                @click="mobileMenuOpen = !mobileMenuOpen"
                class="p-2 text-gray-600 hover:text-gray-900"
              >
                <svg
                  class="w-6 h-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 6h16M4 12h16M4 18h16"
                  ></path>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Mobile menu -->
        <div
          x-show="mobileMenuOpen"
          x-transition:enter="transition ease-out duration-200"
          x-transition:enter-start="opacity-0 transform scale-95"
          x-transition:enter-end="opacity-100 transform scale-100"
          x-transition:leave="transition ease-in duration-75"
          x-transition:leave-start="opacity-100 transform scale-100"
          x-transition:leave-end="opacity-0 transform scale-95"
          class="md:hidden border-t border-gray-200 bg-white"
        >
          <div class="px-2 pt-2 pb-3 space-y-1">
            <a href="{{ url_for('main.index') }}" class="mobile-nav-link"
              >Chat</a
            >
            <a href="{{ url_for('main.registry') }}" class="mobile-nav-link"
              >Registry</a
            >
            <a href="{{ url_for('main.workflows') }}" class="mobile-nav-link"
              >Workflows</a
            >
            <a href="{{ url_for('main.dependencies') }}" class="mobile-nav-link"
              >Dependencies</a
            >
          </div>
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div id="flash-messages" class="fixed top-20 right-4 z-50 space-y-2">
      {% for category, message in messages %}
      <div
        class="alert alert-{{ category }} animate-slide-up"
        x-data="{ show: true }"
        x-show="show"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 transform translate-x-full"
        x-transition:enter-end="opacity-100 transform translate-x-0"
        x-init="setTimeout(() => show = false, 5000)"
      >
        <div class="flex items-center justify-between">
          <span>{{ message }}</span>
          <button
            @click="show = false"
            class="ml-4 text-white hover:text-gray-200"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <!-- Main Content -->
    <main
      class="{% if not request.endpoint == 'main.index' %}max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8{% endif %}"
    >
      {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-auto">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex justify-between items-center">
          <div class="text-sm text-gray-600">
            Â© 2025 {{ app_name }} v{{ app_version }} - Multi-Agent AI
            Orchestration
          </div>
          <div class="flex items-center space-x-6 text-sm text-gray-600">
            <a
              href="{{ url_for('main.help_page') }}"
              class="hover:text-gray-900"
              >Help</a
            >
            <span class="text-gray-400">|</span>
            <span
              >Backend:
              <span
                x-text="systemStatus.connected ? 'Connected' : 'Disconnected'"
              ></span
            ></span>
          </div>
        </div>
      </div>
    </footer>

    <!-- Loading Overlay -->
    <div
      id="loading-overlay"
      class="fixed inset-0 bg-gray-900 bg-opacity-50 z-50 hidden items-center justify-center"
    >
      <div class="bg-white rounded-lg p-6 flex items-center space-x-4">
        <div
          class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
        ></div>
        <span class="text-gray-900">Processing request...</span>
      </div>
    </div>

    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

    {% block scripts %}{% endblock %}
  </body>
</html>
